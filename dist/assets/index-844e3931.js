import{s as g,v as le,m as k,r as h,o as se,c as $,a as c,x as oe,b as r,d as m,f as i,w as s,i as F,t as S,h as p,n as re,k as f,e as P,F as E,g as N,y as z}from"./index-8ea796bf.js";import{a as _}from"./auth-header-ad4d04ca.js";import{r as ie}from"./TrashIcon-e55e552e.js";const C="https://crm.web-hands.ru/api/v1";class ue{getMe(){return g.get(C+"/user/",{headers:_()})}getClients(){return g.get(C+"/clients/list/",{headers:_()})}getClientData(t){return g.get(C+"/clients/data/?id="+t,{headers:_()})}createNewClient(t){return g.post(C+"/clients/save/",t,{headers:_()})}deleteClient(t){return g.post(C+"/clients/delete/",t,{headers:_()})}getClientFields(){return g.get(C+"/clients/fields/",{headers:_()})}}const D=new ue,ce=le("client",{state:()=>({clients:[],client:{},clientFields:[]}),actions:{async getClientsList(){try{const o=await D.getClients();return this.clients=o.data,o}catch(o){return Promise.reject(o)}},async getClientData(o){try{const t=await D.getClientData(o);return this.client=t.data.data,t}catch(t){return Promise.reject(t)}},async createNewClient(o){try{const t=await D.createNewClient(o);console.log("resssspo",t),t.data.code===200?k.success(t.data.data):(console.error("Error fetching data:",t.statusText),k.error(t.data.data))}catch(t){console.error("Error fetching data:",t)}},async deleteClient(o){try{const t=await D.deleteClient(o);t.data.code===200?k.success(t.data.data):(console.error("Error fetching data:",t.statusText),k.error(t.data.data))}catch(t){console.error("Error fetching data:",t)}},async getClientFields(){try{const o=await D.getClientFields();return this.clientFields=o.data.data,o}catch(o){return Promise.reject(o)}}}}),de={class:"p-8",style:{height:"calc(100vh - 92px)"}},pe={class:"flex w-full mt-20"},ve={class:"w-1/2"},me=P("div",{class:"w-1/2 bg-stone-200"},"ddd",-1),fe={key:0},_e={__name:"index",setup(o){const t=ce(),u=h(!1),U=h(!1),B=h(null),b=h(!1),q=h(null),A=async()=>{try{await t.getClientFields(),q.value=t.clientFields,console.log("res",data.value)}catch(a){console.error("Error fetching data in component:",a)}},d=h({type:1}),H=async a=>{U.value=!0,B.value=a,ee(a)},G=()=>{b.value=!b.value},J=h({}),K=a=>{console.log(a),U.value=!1},Q=a=>{console.log("p",a)},W=async a=>{const l=new FormData;for(var v in d.value)d.value.hasOwnProperty(v)&&l.append(v,d.value[v]);u.value=!0,await t.createNewClient(l),await t.getClientsList(),u.value=!1,b.value=!1},X=a=>{a.preventDefault(),a.stopPropagation()},Y=async(a,l)=>{u.value=!0;const v={id:l};await t.deleteClient(v),u.value=!0,L()},Z=[{title:"id",key:"id",dataIndex:"id",width:50},{title:"Клиент",dataIndex:"fio",key:"fio"},{title:"Телефон",dataIndex:"phone_format",key:"phone"},{title:"Email",dataIndex:"email",key:"email"},{title:"O клиенте",dataIndex:"about",key:"about"},{title:"Действие",key:"action"}];se(()=>{L(),A()});const O=$(()=>t.clients),w=$(()=>t.client),L=async()=>{u.value=!0;try{await t.getClientsList().then(a=>{a.data.result==="error"&&k.error(a.data.text),u.value=!1})}catch(a){console.error("Error fetching data in component:",a)}},ee=async a=>{u.value=!0;try{await t.getClientData(a).then(l=>{l.data.result==="error"&&k.error(l.data.text),u.value=!1})}catch(l){console.error("Error fetching data in component:",l)}};return(a,l)=>{const v=c("a-button"),te=c("a-page-header"),ae=c("a-popconfirm"),ne=c("a-table"),I=c("a-input"),y=c("a-form-item"),M=c("a-select-option"),V=c("a-select"),R=c("a-form"),T=c("a-modal"),j=oe("mask");return r(),m("div",de,[i(te,{class:"demo-page-header",style:{border:"1px solid rgb(235, 237, 240)"},onBack:l[0]||(l[0]=()=>a.$router.go(-1))},{extra:s(()=>[i(v,{onClick:G,key:"1",type:"primary"},{default:s(()=>[F(" Добавить клиента ")]),_:1})]),_:1}),F(" "+S(O.value)+" ",1),i(ne,{onChange:l[2]||(l[2]=e=>Q(e)),columns:Z,"data-source":O.value.data,pagination:{pageSize:10,total:O.value.total},"custom-row":e=>{if(e.id)return{onClick:n=>H(e.id)}}},{bodyCell:s(({column:e,record:n})=>[e.key==="action"?(r(),p(ae,{key:0,title:"Действительно удалить?","ok-text":"Да","cancel-text":"Нет",onConfirm:x=>Y(x,n.id),onCancel:a.cancel},{default:s(()=>[i(re(ie),{onClick:l[1]||(l[1]=x=>X(x)),class:"w-10 h-10 cursor-pointer"})]),_:2},1032,["onConfirm","onCancel"])):f("",!0)]),_:1},8,["data-source","pagination","custom-row"]),i(T,{open:U.value,"onUpdate:open":l[4]||(l[4]=e=>U.value=e),footer:null,title:"ID: "+B.value,width:"80%",class:"h-[80vh]",onOk:K},{default:s(()=>[P("div",pe,[P("div",ve,[(r(!0),m(E,null,N(J.value,e=>(r(),m("div",{key:e.name},[i(R,{name:"basic"},{default:s(()=>[e.type==="text"||e.type==="email"||e.type==="textarea"?(r(),p(y,{key:0,label:e.name,name:e.name,rules:[{required:e.required}]},{default:s(()=>[i(I,{value:e.value,"onUpdate:value":n=>e.value=n,ref_for:!0,ref:e.code,type:e.html,onChange:a.onChangeInput,class:"!w-[200px]"},null,8,["value","onUpdate:value","type","onChange"])]),_:2},1032,["label","name","rules"])):f("",!0),e.type==="phone"?(r(),p(y,{key:1,label:e.name,name:e.name,rules:[{required:e.required}]},{default:s(()=>[z(i(I,{value:e.value,"onUpdate:value":n=>e.value=n,type:"tel",placeholder:"+7"},null,8,["value","onUpdate:value"]),[[j,"+# (###) ###-##-##"]])]),_:2},1032,["label","name","rules"])):f("",!0),e.type=="select"?(r(),p(y,{key:2,label:e.name,name:e.name,rules:[{required:e.required,message:"Required"}]},{default:s(()=>[i(V,{value:e.value,"onUpdate:value":n=>e.value=n,"show-search":"","filter-option":a.filterOption,class:"!w-[200px]"},{default:s(()=>[(r(!0),m(E,null,N(e.options,n=>(r(),p(M,{key:n.id,value:n.id},{default:s(()=>[F(S(n.value),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","filter-option"])]),_:2},1032,["label","name","rules"])):f("",!0)]),_:2},1024)]))),128)),i(v,{onClick:l[3]||(l[3]=e=>{console.log(q.value.map(n=>{const x=w.value[n.code];return{name:n.name,value:x,type:n.type,options:n.options}}))})},{default:s(()=>[F("test")]),_:1})]),me])]),_:1},8,["open","title"]),i(T,{open:b.value,"onUpdate:open":l[5]||(l[5]=e=>b.value=e),title:"Новый клиент",width:"80%",class:"h-[80vh]",onOk:W},{default:s(()=>[q.value?(r(),m("div",fe,[(r(!0),m(E,null,N(q.value,e=>(r(),m("div",{key:e.code},[i(R,{model:a.newItem,name:"basic",autocomplete:"off",onFinish:a.onFinish,onFinishFailed:a.onFinishFailed},{default:s(()=>[e.type==="text"||e.type==="email"||e.type==="textarea"?(r(),p(y,{key:0,label:e.name,name:e.name,rules:[{required:e.required}]},{default:s(()=>[i(I,{value:d.value[e.code],"onUpdate:value":n=>d.value[e.code]=n,ref_for:!0,ref:e.code,type:e.html,onChange:a.onChangeInput,class:"!w-[200px]"},null,8,["value","onUpdate:value","type","onChange"])]),_:2},1032,["label","name","rules"])):f("",!0),e.type==="phone"?(r(),p(y,{key:1,label:e.name,name:e.name,rules:[{required:e.required}]},{default:s(()=>[z(i(I,{value:d.value[e.code],"onUpdate:value":n=>d.value[e.code]=n,type:"tel",placeholder:"+7"},null,8,["value","onUpdate:value"]),[[j,"+# (###) ###-##-##"]])]),_:2},1032,["label","name","rules"])):f("",!0),e.type=="select"?(r(),p(y,{key:2,label:e.name,name:e.name,rules:[{required:e.required,message:"Required"}]},{default:s(()=>[i(V,{value:d.value[e.code],"onUpdate:value":n=>d.value[e.code]=n,"show-search":"","filter-option":a.filterOption,class:"!w-[200px]"},{default:s(()=>[(r(!0),m(E,null,N(e.options,n=>(r(),p(M,{key:n.id,value:n.id},{default:s(()=>[F(S(n.value),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","filter-option"])]),_:2},1032,["label","name","rules"])):f("",!0)]),_:2},1032,["model","onFinish","onFinishFailed"])]))),128))])):f("",!0)]),_:1},8,["open"])])}}};export{_e as default};
