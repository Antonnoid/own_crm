import{v as _,x as le,m as O,r as w,o as ne,c as B,a as c,y as oe,b as v,d as k,f as n,w as s,i as U,h as b,q as se,k as F,t as q,e as i,F as L,g as j,z as re}from"./index-c35605e9.js";import{a as y}from"./auth-header-ad4d04ca.js";import{r as ue}from"./TrashIcon-85e30b14.js";const g="https://crm.web-hands.ru/api/v1";class ie{getMe(){return _.get(g+"/user/",{headers:y()})}getOwners(){return _.get(g+"/owners/list/",{headers:y()})}getOwnerData(a){return _.get(g+"/owners/data/?id="+a,{headers:y()})}createNewOwner(a){return _.post(g+"/owners/save/",a,{headers:y()})}deleteOwner(a){return _.post(g+"/owners/delete/",a,{headers:y()})}getOwnerFields(){return _.get(g+"/owners/fields/",{headers:y()})}}const C=new ie,de=le("owner",{state:()=>({owners:[],owner:{},ownerFields:[]}),actions:{async getOwnersList(){try{const o=await C.getOwners();return this.owners=o.data.data,o}catch(o){return Promise.reject(o)}},async getOwnerData(o){try{const a=await C.getOwnerData(o);return this.owner=a.data.data,a}catch(a){return Promise.reject(a)}},async createNewOwner(o){try{const a=await C.createNewOwner(o);console.log("resssspo",a),a.data.code===200?O.success(a.data.data):(console.error("Error fetching data:",a.statusText),O.error(a.data.data))}catch(a){console.error("Error fetching data:",a)}},async deleteOwner(o){try{const a=await C.deleteOwner(o);a.data.code===200?O.success(a.data.data):(console.error("Error fetching data:",a.statusText),O.error(a.data.data))}catch(a){console.error("Error fetching data:",a)}},async getOwnerFields(){try{const o=await C.getOwnerFields();return this.ownerFields=o.data.data,o}catch(o){return Promise.reject(o)}}}}),ce={class:"w-full p-8",style:{height:"calc(100vh - 92px)"}},ve={class:"flex w-full mt-20"},fe={class:"w-1/2"},pe={class:"flex mb-10"},me=i("div",{class:"w-[100px]"},"ФИО",-1),he={class:"flex mb-10"},_e=i("div",{class:"w-[100px]"},"Телефон",-1),we={class:"flex mb-10"},ye=i("div",{class:"w-[100px]"},"Email",-1),ge={class:"flex mb-10"},Oe=i("div",{class:"w-[100px]"},"O клиенте",-1),xe=i("div",{class:"w-1/2 bg-stone-200"},null,-1),ke={key:0},De={__name:"index",setup(o){const a=de(),d=w(!1),D=w(!1),E=w(null),x=w(!1),I=w(null),T=async()=>{try{await a.getOwnerFields(),I.value=a.ownerFields}catch{}},f=w({type:1}),V=l=>{},R=l=>{D.value=!0,E.value=l,K(l)},$=()=>{x.value=!x.value},z=l=>{D.value=!1},A=async l=>{const t=new FormData;for(var p in f.value)f.value.hasOwnProperty(p)&&t.append(p,f.value[p]);d.value=!0,await a.createNewOwner(t),await a.getOwnersList(),d.value=!1,x.value=!1},H=l=>{l.preventDefault(),l.stopPropagation()},G=async(l,t)=>{d.value=!0;const p={id:t};await a.deleteOwner(p),d.value=!0,M()},J=[{title:"id",key:"id",dataIndex:"id",width:50},{title:"Клиент",dataIndex:"fio",key:"fio"},{title:"Телефон",dataIndex:"phone_format",key:"phone"},{title:"Email",dataIndex:"email",key:"email"},{title:"O клиенте",dataIndex:"about",key:"about"},{title:"Действие",key:"action"}];ne(()=>{M(),T()});const S=B(()=>a.owners),r=B(()=>a.owner),M=async()=>{d.value=!0;try{await a.getOwnersList().then(l=>{l.data.result==="error"&&O.error(l.data.text),d.value=!1})}catch{}},K=async l=>{d.value=!0;try{await a.getOwnerData(l).then(t=>{t.data.result==="error"&&O.error(t.data.text),d.value=!1})}catch{}},Q=(l,t)=>{f.value[l.code]=t.target.value};return(l,t)=>{const p=c("a-button"),W=c("a-page-header"),X=c("a-popconfirm"),Y=c("a-table"),h=c("a-input"),m=c("a-form-item"),P=c("a-modal"),Z=c("a-select-option"),ee=c("a-select"),ae=c("a-form"),te=oe("mask");return v(),k("div",ce,[n(W,{class:"demo-page-header",style:{border:"1px solid rgb(235, 237, 240)"},onBack:t[0]||(t[0]=()=>l.$router.go(-1))},{extra:s(()=>[n(p,{onClick:$,key:"1",type:"primary"},{default:s(()=>[U(" Добавить собственника ")]),_:1})]),_:1}),n(Y,{onChange:t[2]||(t[2]=e=>V()),columns:J,"data-source":S.value,pagination:{pageSize:10,total:S.value.total},"custom-row":e=>{if(e.id)return{onClick:u=>R(e.id)}}},{bodyCell:s(({column:e,record:u})=>[e.key==="action"?(v(),b(X,{key:0,title:"Действительно удалить?","ok-text":"Да","cancel-text":"Нет",onConfirm:N=>G(N,u.id),onCancel:l.cancel},{default:s(()=>[n(se(ue),{onClick:t[1]||(t[1]=N=>H(N)),class:"w-10 h-10 cursor-pointer"})]),_:2},1032,["onConfirm","onCancel"])):F("",!0)]),_:1},8,["data-source","pagination","custom-row"]),n(P,{open:D.value,"onUpdate:open":t[7]||(t[7]=e=>D.value=e),footer:null,title:"ID: "+E.value,width:"80%",class:"h-[80vh]",onOk:z},{default:s(()=>[U(q(r.value)+" ",1),i("div",ve,[i("div",fe,[i("ul",null,[i("li",pe,[me,n(m,null,{default:s(()=>[n(h,{value:r.value.name,"onUpdate:value":t[3]||(t[3]=e=>r.value.name=e),"default-value":r.value.name},null,8,["value","default-value"])]),_:1})]),i("li",he,[_e,n(m,null,{default:s(()=>[n(h,{value:r.value.phone_format,"onUpdate:value":t[4]||(t[4]=e=>r.value.phone_format=e),"default-value":r.value.phone_format},null,8,["value","default-value"])]),_:1})]),i("li",we,[ye,n(m,null,{default:s(()=>[n(h,{value:r.value.email,"onUpdate:value":t[5]||(t[5]=e=>r.value.email=e),"default-value":r.value.email},null,8,["value","default-value"])]),_:1})]),i("li",ge,[Oe,n(m,null,{default:s(()=>[n(h,{value:r.value.about,"onUpdate:value":t[6]||(t[6]=e=>r.value.about=e),"default-value":r.value.about},null,8,["value","default-value"])]),_:1})])])]),xe])]),_:1},8,["open","title"]),n(P,{open:x.value,"onUpdate:open":t[8]||(t[8]=e=>x.value=e),title:"Новый собственник",width:"30%",class:"h-[80vh]",onOk:A},{default:s(()=>[I.value?(v(),k("div",ke,[n(ae,{model:l.newItem,name:"basic",autocomplete:"off",onFinish:l.onFinish,onFinishFailed:l.onFinishFailed,layout:"vertical"},{default:s(()=>[(v(!0),k(L,null,j(I.value,e=>(v(),k("div",{class:"flex flex-col justify-start !text-left",key:e.code},[e.type==="text"||e.type==="email"||e.type==="textarea"?(v(),b(m,{key:0,label:e.name,name:e.name,rules:[{required:e.required?"true":"false"}]},{default:s(()=>[n(h,{ref_for:!0,ref:e.code,type:e.html,onChange:u=>Q(e,u),class:"!w-full"},null,8,["type","onChange"]),U(" "+q(f.value[e.code])+" - "+q(e.required),1)]),_:2},1032,["label","name","rules"])):F("",!0),e.type==="phone"?(v(),b(m,{key:1,label:e.name,name:e.name,rules:[{required:e.required}],class:"!w-full"},{default:s(()=>[re(n(h,{value:f.value[e.code],"onUpdate:value":u=>f.value[e.code]=u,type:"tel",placeholder:"+7"},null,8,["value","onUpdate:value"]),[[te,"+# (###) ###-##-##"]])]),_:2},1032,["label","name","rules"])):F("",!0),e.type=="select"?(v(),b(m,{key:2,label:e.name,name:e.name,rules:[{required:e.required,message:"Required"}]},{default:s(()=>[n(ee,{value:f.value[e.code],"onUpdate:value":u=>f.value[e.code]=u,"show-search":"","filter-option":l.filterOption,class:"!w-full"},{default:s(()=>[(v(!0),k(L,null,j(e.options,u=>(v(),b(Z,{key:u.id,value:u.id},{default:s(()=>[U(q(u.value),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","filter-option"])]),_:2},1032,["label","name","rules"])):F("",!0)]))),128))]),_:1},8,["model","onFinish","onFinishFailed"])])):F("",!0)]),_:1},8,["open"])])}}};export{De as default};
