import{s as v,v as ae,m as g,r as h,o as ne,c as L,a as c,x as oe,b as d,d as O,f as u,w as l,i as N,t as f,h as k,n as se,k as x,e as s,F as M,g as T,y as re}from"./index-8ea796bf.js";import{a as _}from"./auth-header-ad4d04ca.js";import{r as le}from"./TrashIcon-e55e552e.js";const w="https://crm.web-hands.ru/api/v1";class ie{getMe(){return v.get(w+"/user/",{headers:_()})}getOwners(){return v.get(w+"/owners/list/",{headers:_()})}getOwnerData(e){return v.get(w+"/owners/data/?id="+e,{headers:_()})}createNewOwner(e){return v.post(w+"/owners/save/",e,{headers:_()})}deleteOwner(e){return v.post(w+"/owners/delete/",e,{headers:_()})}getOwnerFields(){return v.get(w+"/owners/fields/",{headers:_()})}}const b=new ie,ce=ae("owner",{state:()=>({owners:[],owner:{},ownerFields:[]}),actions:{async getOwnersList(){try{const o=await b.getOwners();return this.owners=o.data.data,o}catch(o){return Promise.reject(o)}},async getOwnerData(o){try{const e=await b.getOwnerData(o);return this.owner=e.data.data,e}catch(e){return Promise.reject(e)}},async createNewOwner(o){try{const e=await b.createNewOwner(o);console.log("resssspo",e),e.data.code===200?g.success(e.data.data):(console.error("Error fetching data:",e.statusText),g.error(e.data.data))}catch(e){console.error("Error fetching data:",e)}},async deleteOwner(o){try{const e=await b.deleteOwner(o);e.data.code===200?g.success(e.data.data):(console.error("Error fetching data:",e.statusText),g.error(e.data.data))}catch(e){console.error("Error fetching data:",e)}},async getOwnerFields(){try{const o=await b.getOwnerFields();return this.ownerFields=o.data.data,o}catch(o){return Promise.reject(o)}}}}),de={class:"p-8",style:{height:"calc(100vh - 92px)"}},ue={class:"flex w-full mt-20"},pe={class:"w-1/2"},me={class:"flex mb-10"},ve=s("div",{class:"w-[100px]"},"ФИО",-1),he={class:"w-1/2"},fe={class:"flex mb-10"},_e=s("div",{class:"w-[100px]"},"Телефон",-1),we={class:"w-1/2"},ge={class:"flex mb-10"},ye=s("div",{class:"w-[100px]"},"Email",-1),Oe={class:"w-1/2"},ke={class:"flex mb-10"},xe=s("div",{class:"w-[100px]"},"O клиенте",-1),be={class:"w-1/2"},Fe=s("div",{class:"w-1/2 bg-stone-200"},"ddd",-1),Ce={key:0},Ue={__name:"index",setup(o){const e=ce(),i=h(!1),F=h(!1),q=h(null),y=h(!1),D=h(null),V=async()=>{try{await e.getOwnerFields(),D.value=e.ownerFields,console.log("res",data.value)}catch(a){console.error("Error fetching data in component:",a)}},p=h({type:1}),j=a=>{console.log("p",a)},R=a=>{F.value=!0,q.value=a,K(a)},$=()=>{y.value=!y.value},z=a=>{console.log(a),F.value=!1},A=async a=>{const n=new FormData;for(var m in p.value)p.value.hasOwnProperty(m)&&n.append(m,p.value[m]);i.value=!0,await e.createNewOwner(n),await e.getOwnersList(),i.value=!1,y.value=!1},H=a=>{a.preventDefault(),a.stopPropagation()},G=async(a,n)=>{i.value=!0;const m={id:n};await e.deleteOwner(m),i.value=!0,S()},J=[{title:"id",key:"id",dataIndex:"id",width:50},{title:"Клиент",dataIndex:"fio",key:"fio"},{title:"Телефон",dataIndex:"phone_format",key:"phone"},{title:"Email",dataIndex:"email",key:"email"},{title:"O клиенте",dataIndex:"about",key:"about"},{title:"Действие",key:"action"}];ne(()=>{S(),V()});const E=L(()=>e.owners),C=L(()=>e.owner),S=async()=>{i.value=!0;try{await e.getOwnersList().then(a=>{a.data.result==="error"&&g.error(a.data.text),i.value=!1})}catch(a){console.error("Error fetching data in component:",a)}},K=async a=>{i.value=!0;try{await e.getOwnerData(a).then(n=>{n.data.result==="error"&&g.error(n.data.text),i.value=!1})}catch(n){console.error("Error fetching data in component:",n)}};return(a,n)=>{const m=c("a-button"),Q=c("a-page-header"),W=c("a-popconfirm"),X=c("a-table"),P=c("a-modal"),B=c("a-input"),I=c("a-form-item"),Y=c("a-select-option"),Z=c("a-select"),ee=c("a-form"),te=oe("mask");return d(),O("div",de,[u(Q,{class:"demo-page-header",style:{border:"1px solid rgb(235, 237, 240)"},onBack:n[0]||(n[0]=()=>a.$router.go(-1))},{extra:l(()=>[u(m,{onClick:$,key:"1",type:"primary"},{default:l(()=>[N(" Добавить собственника ")]),_:1})]),_:1}),N(" "+f(E.value)+" ",1),u(X,{onChange:n[2]||(n[2]=t=>j(t)),columns:J,"data-source":E.value,pagination:{pageSize:10,total:E.value.total},"custom-row":t=>{if(t.id)return{onClick:r=>R(t.id)}}},{bodyCell:l(({column:t,record:r})=>[t.key==="action"?(d(),k(W,{key:0,title:"Действительно удалить?","ok-text":"Да","cancel-text":"Нет",onConfirm:U=>G(U,r.id),onCancel:a.cancel},{default:l(()=>[u(se(le),{onClick:n[1]||(n[1]=U=>H(U)),class:"w-10 h-10 cursor-pointer"})]),_:2},1032,["onConfirm","onCancel"])):x("",!0)]),_:1},8,["data-source","pagination","custom-row"]),u(P,{open:F.value,"onUpdate:open":n[3]||(n[3]=t=>F.value=t),footer:null,title:"ID: "+q.value,width:"80%",class:"h-[80vh]",onOk:z},{default:l(()=>[s("div",ue,[s("div",pe,[s("ul",null,[s("li",me,[ve,s("div",he,f(C.value.fio),1)]),s("li",fe,[_e,s("div",we,f(C.value.phone_format),1)]),s("li",ge,[ye,s("div",Oe,f(C.value.email),1)]),s("li",ke,[xe,s("div",be,f(C.value.about),1)])])]),Fe])]),_:1},8,["open","title"]),u(P,{open:y.value,"onUpdate:open":n[4]||(n[4]=t=>y.value=t),title:"Новый собственник",width:"80%",class:"h-[80vh]",onOk:A},{default:l(()=>[D.value?(d(),O("div",Ce,[(d(!0),O(M,null,T(D.value,t=>(d(),O("div",{key:t.code},[u(ee,{model:a.newItem,name:"basic",autocomplete:"off",onFinish:a.onFinish,onFinishFailed:a.onFinishFailed},{default:l(()=>[t.type==="text"||t.type==="email"||t.type==="textarea"?(d(),k(I,{key:0,label:t.name,name:t.name,rules:[{required:t.required}]},{default:l(()=>[u(B,{value:p.value[t.code],"onUpdate:value":r=>p.value[t.code]=r,ref_for:!0,ref:t.code,type:t.html,onChange:a.onChangeInput,class:"!w-[200px]"},null,8,["value","onUpdate:value","type","onChange"])]),_:2},1032,["label","name","rules"])):x("",!0),t.type==="phone"?(d(),k(I,{key:1,label:t.name,name:t.name,rules:[{required:t.required}]},{default:l(()=>[re(u(B,{value:p.value[t.code],"onUpdate:value":r=>p.value[t.code]=r,type:"tel",placeholder:"+7"},null,8,["value","onUpdate:value"]),[[te,"+# (###) ###-##-##"]])]),_:2},1032,["label","name","rules"])):x("",!0),t.type=="select"?(d(),k(I,{key:2,label:t.name,name:t.name,rules:[{required:t.required,message:"Required"}]},{default:l(()=>[u(Z,{value:p.value[t.code],"onUpdate:value":r=>p.value[t.code]=r,"show-search":"","filter-option":a.filterOption,class:"!w-[200px]"},{default:l(()=>[(d(!0),O(M,null,T(t.options,r=>(d(),k(Y,{key:r.id,value:r.id},{default:l(()=>[N(f(r.value),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","filter-option"])]),_:2},1032,["label","name","rules"])):x("",!0)]),_:2},1032,["model","onFinish","onFinishFailed"])]))),128))])):x("",!0)]),_:1},8,["open"])])}}};export{Ue as default};
