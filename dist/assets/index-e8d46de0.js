import{s as h,v as te,m as y,r as _,o as ne,c as P,a as c,x as oe,b as v,d as x,f as l,w as s,i as B,h as b,n as le,k as F,e as r,t as L,F as M,g as j,y as se}from"./index-dc8ff5dc.js";import{a as w}from"./auth-header-ad4d04ca.js";import{r as re}from"./TrashIcon-3bffa9f5.js";const g="https://crm.web-hands.ru/api/v1";class ue{getMe(){return h.get(g+"/user/",{headers:w()})}getOwners(){return h.get(g+"/owners/list/",{headers:w()})}getOwnerData(a){return h.get(g+"/owners/data/?id="+a,{headers:w()})}createNewOwner(a){return h.post(g+"/owners/save/",a,{headers:w()})}deleteOwner(a){return h.post(g+"/owners/delete/",a,{headers:w()})}getOwnerFields(){return h.get(g+"/owners/fields/",{headers:w()})}}const C=new ue,ie=te("owner",{state:()=>({owners:[],owner:{},ownerFields:[]}),actions:{async getOwnersList(){try{const o=await C.getOwners();return this.owners=o.data.data,o}catch(o){return Promise.reject(o)}},async getOwnerData(o){try{const a=await C.getOwnerData(o);return this.owner=a.data.data,a}catch(a){return Promise.reject(a)}},async createNewOwner(o){try{const a=await C.createNewOwner(o);console.log("resssspo",a),a.data.code===200?y.success(a.data.data):(console.error("Error fetching data:",a.statusText),y.error(a.data.data))}catch(a){console.error("Error fetching data:",a)}},async deleteOwner(o){try{const a=await C.deleteOwner(o);a.data.code===200?y.success(a.data.data):(console.error("Error fetching data:",a.statusText),y.error(a.data.data))}catch(a){console.error("Error fetching data:",a)}},async getOwnerFields(){try{const o=await C.getOwnerFields();return this.ownerFields=o.data.data,o}catch(o){return Promise.reject(o)}}}}),de={class:"w-full p-8",style:{height:"calc(100vh - 92px)"}},ce={class:"flex w-full mt-20"},ve={class:"w-1/2"},pe={class:"flex mb-10"},fe=r("div",{class:"w-[100px]"},"ФИО",-1),me={class:"w-1/2"},he={class:"flex mb-10"},_e=r("div",{class:"w-[100px]"},"Телефон",-1),we={class:"flex mb-10"},ge=r("div",{class:"w-[100px]"},"Email",-1),ye={class:"flex mb-10"},Oe=r("div",{class:"w-[100px]"},"O клиенте",-1),ke=r("div",{class:"w-1/2 bg-stone-200"},"ddd",-1),xe={key:0},De={__name:"index",setup(o){const a=ie(),i=_(!1),D=_(!1),I=_(null),O=_(!1),U=_(null),T=async()=>{try{await a.getOwnerFields(),U.value=a.ownerFields,console.log("res",data.value)}catch(t){console.error("Error fetching data in component:",t)}},p=_({type:1}),V=t=>{console.log("p",t)},R=t=>{D.value=!0,I.value=t,K(t)},$=()=>{O.value=!O.value},z=t=>{console.log(t),D.value=!1},A=async t=>{const n=new FormData;for(var f in p.value)p.value.hasOwnProperty(f)&&n.append(f,p.value[f]);i.value=!0,await a.createNewOwner(n),await a.getOwnersList(),i.value=!1,O.value=!1},H=t=>{t.preventDefault(),t.stopPropagation()},G=async(t,n)=>{i.value=!0;const f={id:n};await a.deleteOwner(f),i.value=!0,q()},J=[{title:"id",key:"id",dataIndex:"id",width:50},{title:"Клиент",dataIndex:"fio",key:"fio"},{title:"Телефон",dataIndex:"phone_format",key:"phone"},{title:"Email",dataIndex:"email",key:"email"},{title:"O клиенте",dataIndex:"about",key:"about"},{title:"Действие",key:"action"}];ne(()=>{q(),T()});const N=P(()=>a.owners),d=P(()=>a.owner),q=async()=>{i.value=!0;try{await a.getOwnersList().then(t=>{t.data.result==="error"&&y.error(t.data.text),i.value=!1})}catch(t){console.error("Error fetching data in component:",t)}},K=async t=>{i.value=!0;try{await a.getOwnerData(t).then(n=>{n.data.result==="error"&&y.error(n.data.text),i.value=!1})}catch(n){console.error("Error fetching data in component:",n)}};return(t,n)=>{const f=c("a-button"),Q=c("a-page-header"),W=c("a-popconfirm"),X=c("a-table"),k=c("a-input"),m=c("a-form-item"),S=c("a-modal"),Y=c("a-select-option"),Z=c("a-select"),ee=c("a-form"),ae=oe("mask");return v(),x("div",de,[l(Q,{class:"demo-page-header",style:{border:"1px solid rgb(235, 237, 240)"},onBack:n[0]||(n[0]=()=>t.$router.go(-1))},{extra:s(()=>[l(f,{onClick:$,key:"1",type:"primary"},{default:s(()=>[B(" Добавить собственника ")]),_:1})]),_:1}),l(X,{onChange:n[2]||(n[2]=e=>V(e)),columns:J,"data-source":N.value,pagination:{pageSize:10,total:N.value.total},"custom-row":e=>{if(e.id)return{onClick:u=>R(e.id)}}},{bodyCell:s(({column:e,record:u})=>[e.key==="action"?(v(),b(W,{key:0,title:"Действительно удалить?","ok-text":"Да","cancel-text":"Нет",onConfirm:E=>G(E,u.id),onCancel:t.cancel},{default:s(()=>[l(le(re),{onClick:n[1]||(n[1]=E=>H(E)),class:"w-10 h-10 cursor-pointer"})]),_:2},1032,["onConfirm","onCancel"])):F("",!0)]),_:1},8,["data-source","pagination","custom-row"]),l(S,{open:D.value,"onUpdate:open":n[6]||(n[6]=e=>D.value=e),footer:null,title:"ID: "+I.value,width:"80%",class:"h-[80vh]",onOk:z},{default:s(()=>[r("div",ce,[r("div",ve,[r("ul",null,[r("li",pe,[fe,r("div",me,L(d.value.fio),1)]),r("li",he,[_e,l(m,null,{default:s(()=>[l(k,{value:d.value.phone_format,"onUpdate:value":n[3]||(n[3]=e=>d.value.phone_format=e),"default-value":d.value.phone_format},null,8,["value","default-value"])]),_:1})]),r("li",we,[ge,l(m,null,{default:s(()=>[l(k,{value:d.value.email,"onUpdate:value":n[4]||(n[4]=e=>d.value.email=e),"default-value":d.value.email},null,8,["value","default-value"])]),_:1})]),r("li",ye,[Oe,l(m,null,{default:s(()=>[l(k,{value:d.value.about,"onUpdate:value":n[5]||(n[5]=e=>d.value.about=e),"default-value":d.value.about},null,8,["value","default-value"])]),_:1})])])]),ke])]),_:1},8,["open","title"]),l(S,{open:O.value,"onUpdate:open":n[7]||(n[7]=e=>O.value=e),title:"Новый собственник",width:"30%",class:"h-[80vh]",onOk:A},{default:s(()=>[U.value?(v(),x("div",xe,[l(ee,{model:t.newItem,name:"basic",autocomplete:"off",onFinish:t.onFinish,onFinishFailed:t.onFinishFailed,layout:"vertical"},{default:s(()=>[(v(!0),x(M,null,j(U.value,e=>(v(),x("div",{class:"flex flex-col justify-start !text-left",key:e.code},[e.type==="text"||e.type==="email"||e.type==="textarea"?(v(),b(m,{key:0,label:e.name,name:e.name,rules:[{required:e.required}]},{default:s(()=>[l(k,{value:p.value[e.code],"onUpdate:value":u=>p.value[e.code]=u,ref_for:!0,ref:e.code,type:e.html,onChange:t.onChangeInput,class:"!w-full"},null,8,["value","onUpdate:value","type","onChange"])]),_:2},1032,["label","name","rules"])):F("",!0),e.type==="phone"?(v(),b(m,{key:1,label:e.name,name:e.name,rules:[{required:e.required}],class:"!w-full"},{default:s(()=>[se(l(k,{value:p.value[e.code],"onUpdate:value":u=>p.value[e.code]=u,type:"tel",placeholder:"+7"},null,8,["value","onUpdate:value"]),[[ae,"+# (###) ###-##-##"]])]),_:2},1032,["label","name","rules"])):F("",!0),e.type=="select"?(v(),b(m,{key:2,label:e.name,name:e.name,rules:[{required:e.required,message:"Required"}]},{default:s(()=>[l(Z,{value:p.value[e.code],"onUpdate:value":u=>p.value[e.code]=u,"show-search":"","filter-option":t.filterOption,class:"!w-full"},{default:s(()=>[(v(!0),x(M,null,j(e.options,u=>(v(),b(Y,{key:u.id,value:u.id},{default:s(()=>[B(L(u.value),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","filter-option"])]),_:2},1032,["label","name","rules"])):F("",!0)]))),128))]),_:1},8,["model","onFinish","onFinishFailed"])])):F("",!0)]),_:1},8,["open"])])}}};export{De as default};
