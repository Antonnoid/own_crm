import{s as h,v as re,m as _,r as v,o as ue,c as j,a as u,x as de,b as d,d as f,e as r,f as l,w as o,y as ce,i as C,t as N,h as w,q as pe,k as L,F as S,g as M,z as me}from"./index-048c2267.js";import{a as g}from"./auth-header-ad4d04ca.js";import{r as ve}from"./TrashIcon-acf970e6.js";const y="https://crm.web-hands.ru/api/v1";class fe{getMe(){return h.get(y+"/user/",{headers:g()})}getClients(){return h.get(y+"/clients/list/",{headers:g()})}getClientData(a){return h.get(y+"/clients/data/?id="+a,{headers:g()})}createNewClient(a){return h.post(y+"/clients/save/",a,{headers:g()})}deleteClient(a){return h.post(y+"/clients/delete/",a,{headers:g()})}getClientFields(){return h.get(y+"/clients/fields/",{headers:g()})}}const U=new fe,he=re("client",{state:()=>({clients:[],client:{},clientFields:[]}),actions:{async getClientsList(){try{const i=await U.getClients();return this.clients=i.data,i}catch(i){return Promise.reject(i)}},async getClientData(i){try{const a=await U.getClientData(i);return this.client=a.data.data,a}catch(a){return Promise.reject(a)}},async createNewClient(i){try{const a=await U.createNewClient(i);console.log("resssspo",a),a.data.code===200?_.success(a.data.data):(console.error("Error fetching data:",a.statusText),_.error(a.data.data))}catch(a){console.error("Error fetching data:",a)}},async deleteClient(i){try{const a=await U.deleteClient(i);a.data.code===200?_.success(a.data.data):(console.error("Error fetching data:",a.statusText),_.error(a.data.data))}catch(a){console.error("Error fetching data:",a)}},async getClientFields(){try{const i=await U.getClientFields();return this.clientFields=i.data.data,i}catch(i){return Promise.reject(i)}}}}),ge={class:"px-[5rem] pt-[3.2rem] pb-[1rem] h-full relative flex-1",style:{width:"calc(100vh - 24rem)"}},ye={class:"flex gap-x-[3rem] mb-m-base"},Ce=r("div",{class:"text-main-title font-bold"},"Собственники",-1),_e={class:"flex flex-col mb-m-base"},be={class:"flex flex-wrap mb-m-base gap-[1.6rem]"},ke={class:"numeric-input-title"},Fe={class:"flex gap-x-[3rem] items-center"},we=r("div",null,[C(" Найдено: "),r("span",null,"5")],-1),Le=r("svg",{width:"22",height:"23",viewBox:"0 0 22 23",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[r("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M18 11.5C18 15.366 14.866 18.5 11 18.5C7.13401 18.5 4 15.366 4 11.5C4 7.63401 7.13401 4.5 11 4.5C14.866 4.5 18 7.63401 18 11.5ZM11 12.2071L8.35355 14.8536L7.64645 14.1464L10.2929 11.5L7.64645 8.85355L8.35355 8.14645L11 10.7929L13.6464 8.14645L14.3536 8.85355L11.7071 11.5L14.3536 14.1464L13.6464 14.8536L11 12.2071Z",fill:"#4064BF"})],-1),Ue={class:"flex w-full mt-20"},De={class:"w-1/2"},xe=r("div",{class:"w-1/2 bg-stone-200"},null,-1),Ie={key:0},qe={__name:"index",setup(i){const a=he(),c=v(!1),D=v(!1),O=v(null),b=v(!1),x=v(null),z=async()=>{try{await a.getClientFields(),x.value=a.clientFields,console.log("res",data.value)}catch(e){console.error("Error fetching data in component:",e)}},p=v({type:1}),R=async e=>{D.value=!0,O.value=e,Y(e)},$=()=>{b.value=!b.value},E=v({}),Z=e=>{console.log(e),D.value=!1},A=e=>{console.log("e",e)},H=e=>{console.log("p",e)},G=async e=>{const n=new FormData;for(var m in p.value)p.value.hasOwnProperty(m)&&n.append(m,p.value[m]);c.value=!0,await a.createNewClient(n),await a.getClientsList(),c.value=!1,b.value=!1},J=e=>{e.preventDefault(),e.stopPropagation()},Q=async(e,n)=>{c.value=!0;const m={id:n};await a.deleteClient(m),c.value=!0,K()},W=[{title:"id",key:"id",dataIndex:"id",width:50},{title:"Клиент",dataIndex:"fio",key:"fio"},{title:"Телефон",dataIndex:"phone_format",key:"phone"},{title:"Email",dataIndex:"email",key:"email"},{title:"O клиенте",dataIndex:"about",key:"about"},{title:"Действие",key:"action"}];ue(()=>{K(),z()});const P=j(()=>a.clients),X=j(()=>a.client),K=async()=>{c.value=!0;try{await a.getClientsList().then(e=>{e.data.result==="error"&&_.error(e.data.text),c.value=!1})}catch(e){console.error("Error fetching data in component:",e)}},Y=async e=>{c.value=!0;try{await a.getClientData(e).then(n=>{n.data.result==="error"?(_.error(n.data.text),c.value=!1):(c.value=!1,E.value=n.data.data)})}catch(n){console.error("Error fetching data in component:",n)}};return(e,n)=>{const m=u("a-tab-pane"),ee=u("a-tabs"),I=u("a-input"),te=u("a-tooltip"),k=u("a-select"),V=u("a-button"),ae=u("a-space"),ne=u("a-page-header"),le=u("a-popconfirm"),oe=u("a-table"),B=u("a-form-item"),q=u("a-form"),T=u("a-modal"),se=u("a-select-option"),ie=de("mask");return d(),f("div",ge,[r("div",ye,[Ce,r("div",null,[l(ee,{activeKey:e.activeKey,"onUpdate:activeKey":n[0]||(n[0]=t=>e.activeKey=t),onChange:e.onTabsChange,type:"card",class:"h-[4rem] text-inherit"},{default:o(()=>[l(m,{key:"1",tab:"Мои",class:"h-[4rem] text-inherit"}),l(m,{key:"2",tab:"Все",class:"h-[4rem]"})]),_:1},8,["activeKey","onChange"])])]),r("div",_e,[r("div",be,[l(te,{trigger:["focus"],placement:"topLeft","overlay-class-name":"numeric-input"},ce({default:o(()=>[l(I,{value:e.inputValue,"onUpdate:value":n[1]||(n[1]=t=>e.inputValue=t),placeholder:"Input a number","max-length":30,style:{width:"28rem"},onBlur:e.onBlur},null,8,["value","onBlur"])]),_:2},[e.inputValue?{name:"title",fn:o(()=>[r("span",ke,N(e.formatValue),1)]),key:"0"}:void 0]),1024),l(k,{value:e.value,"onUpdate:value":n[2]||(n[2]=t=>e.value=t),mode:"tags",style:{width:"28rem"},placeholder:"Ответственный брокер",options:e.options,onChange:e.handleChange},null,8,["value","options","onChange"]),l(k,{value:e.value,"onUpdate:value":n[3]||(n[3]=t=>e.value=t),mode:"tags",style:{width:"28rem"},placeholder:"Тип сделки",options:e.options,onChange:e.handleChange},null,8,["value","options","onChange"]),l(k,{value:e.value,"onUpdate:value":n[4]||(n[4]=t=>e.value=t),mode:"tags",style:{width:"28rem"},placeholder:"Статус",options:e.options,onChange:e.handleChange},null,8,["value","options","onChange"]),l(k,{value:e.value,"onUpdate:value":n[5]||(n[5]=t=>e.value=t),mode:"tags",style:{width:"28rem"},placeholder:"Статус",options:e.options,onChange:e.handleChange},null,8,["value","options","onChange"])]),r("div",Fe,[we,l(ae,{class:"mr-12"},{default:o(()=>[l(V,{size:"middle",class:"flex items-center gap-1"},{default:o(()=>[C(" Сбросить всё "),Le]),_:1})]),_:1})])]),l(ne,{class:"demo-page-header",style:{border:"1px solid rgb(235, 237, 240)"},onBack:n[6]||(n[6]=()=>e.$router.go(-1))},{extra:o(()=>[l(V,{onClick:$,key:"1",type:"primary"},{default:o(()=>[C(" Добавить клиента ")]),_:1})]),_:1}),l(oe,{onChange:n[8]||(n[8]=t=>H(t)),columns:W,"data-source":P.value.data,pagination:{pageSize:10,total:P.value.total},"custom-row":t=>{if(t.id)return{onClick:s=>R(t.id)}}},{bodyCell:o(({column:t,record:s})=>[t.key==="action"?(d(),w(le,{key:0,title:"Действительно удалить?","ok-text":"Да","cancel-text":"Нет",onConfirm:F=>Q(F,s.id),onCancel:e.cancel},{default:o(()=>[l(pe(ve),{onClick:n[7]||(n[7]=F=>J(F)),class:"w-10 h-10 cursor-pointer"})]),_:2},1032,["onConfirm","onCancel"])):L("",!0)]),_:1},8,["data-source","pagination","custom-row"]),l(T,{open:D.value,"onUpdate:open":n[10]||(n[10]=t=>D.value=t),footer:null,title:"ID: "+O.value,width:"80%",class:"h-[80vh]",onOk:Z},{default:o(()=>[C(N(E.value)+" ",1),r("div",Ue,[r("div",De,[l(q,{name:"basic"},{default:o(()=>[(d(!0),f(S,null,M(Object.entries(E.value),t=>(d(),f("div",{key:t},[l(B,{label:t[0],name:t[0]},{default:o(()=>[l(I,{value:t[1],"onUpdate:value":s=>t[1]=s,"default-value":t[1],onChange:A,class:"!w-full"},null,8,["value","onUpdate:value","default-value"])]),_:2},1032,["label","name"])]))),128))]),_:1}),l(V,{onClick:n[9]||(n[9]=t=>{console.log(x.value.map(s=>{const F=X.value[s.code];return{name:s.name,value:F,type:s.type,options:s.options}}))})},{default:o(()=>[C("test ")]),_:1})]),xe])]),_:1},8,["open","title"]),l(T,{open:b.value,"onUpdate:open":n[11]||(n[11]=t=>b.value=t),title:"Новый клиент",width:"40%",onOk:G},{default:o(()=>[x.value?(d(),f("div",Ie,[l(q,{model:e.newItem,name:"basic",autocomplete:"off",onFinish:e.onFinish,onFinishFailed:e.onFinishFailed,layout:"vertical",class:"flex flex-col gap-6"},{default:o(()=>[(d(!0),f(S,null,M(x.value,t=>(d(),f("div",{key:t.code,class:"flex flex-wrap gap-4"},[r("div",null,[l(q,{model:e.newItem,name:"basic",autocomplete:"off",onFinish:e.onFinish,onFinishFailed:e.onFinishFailed,class:"flex flex-col gap-6"},{default:o(()=>[t.type==="text"||t.type==="email"||t.type==="textarea"?(d(),w(B,{key:0,label:t.name,name:t.name,rules:[{required:t.required}]},{default:o(()=>[l(I,{value:p.value[t.code],"onUpdate:value":s=>p.value[t.code]=s,ref_for:!0,ref:t.code,type:t.html,onChange:e.onChangeInput,class:"!w-full"},null,8,["value","onUpdate:value","type","onChange"])]),_:2},1032,["label","name","rules"])):L("",!0),t.type==="phone"?(d(),w(B,{key:1,label:t.name,name:t.name,rules:[{required:t.required}]},{default:o(()=>[me(l(I,{value:p.value[t.code],"onUpdate:value":s=>p.value[t.code]=s,type:"tel",placeholder:"+7",class:"!w-[200px]"},null,8,["value","onUpdate:value"]),[[ie,"+# (###) ###-##-##"]])]),_:2},1032,["label","name","rules"])):L("",!0),t.type=="select"?(d(),w(B,{key:2,label:t.name,name:t.name,rules:[{required:t.required,message:"Required"}]},{default:o(()=>[l(k,{value:p.value[t.code],"onUpdate:value":s=>p.value[t.code]=s,"show-search":"","filter-option":e.filterOption,class:"!w-full"},{default:o(()=>[(d(!0),f(S,null,M(t.options,s=>(d(),w(se,{key:s.id,value:s.id},{default:o(()=>[C(N(s.value),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","filter-option"])]),_:2},1032,["label","name","rules"])):L("",!0)]),_:2},1032,["model","onFinish","onFinishFailed"])])]))),128))]),_:1},8,["model","onFinish","onFinishFailed"])])):L("",!0)]),_:1},8,["open"])])}}};export{qe as default};
