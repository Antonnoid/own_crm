import{v,x as le,m as y,r as f,o as oe,c as V,a as u,y as se,b as i,d as m,f as r,w as s,i as I,h as k,q as re,k as F,t as j,e as U,F as O,g as S,z as ie}from"./index-c35605e9.js";import{a as h}from"./auth-header-ad4d04ca.js";import{r as ce}from"./TrashIcon-85e30b14.js";const g="https://crm.web-hands.ru/api/v1";class ue{getMe(){return v.get(g+"/user/",{headers:h()})}getClients(){return v.get(g+"/clients/list/",{headers:h()})}getClientData(t){return v.get(g+"/clients/data/?id="+t,{headers:h()})}createNewClient(t){return v.post(g+"/clients/save/",t,{headers:h()})}deleteClient(t){return v.post(g+"/clients/delete/",t,{headers:h()})}getClientFields(){return v.get(g+"/clients/fields/",{headers:h()})}}const b=new ue,de=le("client",{state:()=>({clients:[],client:{},clientFields:[]}),actions:{async getClientsList(){try{const o=await b.getClients();return this.clients=o.data,o}catch(o){return Promise.reject(o)}},async getClientData(o){try{const t=await b.getClientData(o);return this.client=t.data.data,t}catch(t){return Promise.reject(t)}},async createNewClient(o){try{const t=await b.createNewClient(o);console.log("resssspo",t),t.data.code===200?y.success(t.data.data):(console.error("Error fetching data:",t.statusText),y.error(t.data.data))}catch(t){console.error("Error fetching data:",t)}},async deleteClient(o){try{const t=await b.deleteClient(o);t.data.code===200?y.success(t.data.data):(console.error("Error fetching data:",t.statusText),y.error(t.data.data))}catch(t){console.error("Error fetching data:",t)}},async getClientFields(){try{const o=await b.getClientFields();return this.clientFields=o.data.data,o}catch(o){return Promise.reject(o)}}}}),pe={class:"w-full p-8",style:{height:"calc(100vh - 92px)"}},fe={class:"flex w-full mt-20"},me={class:"w-1/2"},ve=U("div",{class:"w-1/2 bg-stone-200"},null,-1),he={key:0},Ce={__name:"index",setup(o){const t=de(),c=f(!1),x=f(!1),P=f(null),_=f(!1),D=f(null),T=async()=>{try{await t.getClientFields(),D.value=t.clientFields,console.log("res",data.value)}catch(a){console.error("Error fetching data in component:",a)}},d=f({type:1}),R=async a=>{x.value=!0,P.value=a,X(a)},$=()=>{_.value=!_.value},E=f({}),z=a=>{console.log(a),x.value=!1},A=a=>{console.log("e",a)},H=a=>{console.log("p",a)},G=async a=>{const n=new FormData;for(var p in d.value)d.value.hasOwnProperty(p)&&n.append(p,d.value[p]);c.value=!0,await t.createNewClient(n),await t.getClientsList(),c.value=!1,_.value=!1},J=a=>{a.preventDefault(),a.stopPropagation()},K=async(a,n)=>{c.value=!0;const p={id:n};await t.deleteClient(p),c.value=!0,L()},Q=[{title:"id",key:"id",dataIndex:"id",width:50},{title:"Клиент",dataIndex:"fio",key:"fio"},{title:"Телефон",dataIndex:"phone_format",key:"phone"},{title:"Email",dataIndex:"email",key:"email"},{title:"O клиенте",dataIndex:"about",key:"about"},{title:"Действие",key:"action"}];oe(()=>{L(),T()});const B=V(()=>t.clients),W=V(()=>t.client),L=async()=>{c.value=!0;try{await t.getClientsList().then(a=>{a.data.result==="error"&&y.error(a.data.text),c.value=!1})}catch(a){console.error("Error fetching data in component:",a)}},X=async a=>{c.value=!0;try{await t.getClientData(a).then(n=>{n.data.result==="error"?(y.error(n.data.text),c.value=!1):(c.value=!1,E.value=n.data.data)})}catch(n){console.error("Error fetching data in component:",n)}};return(a,n)=>{const p=u("a-button"),Y=u("a-page-header"),Z=u("a-popconfirm"),ee=u("a-table"),q=u("a-input"),w=u("a-form-item"),N=u("a-form"),M=u("a-modal"),te=u("a-select-option"),ae=u("a-select"),ne=se("mask");return i(),m("div",pe,[r(Y,{class:"demo-page-header",style:{border:"1px solid rgb(235, 237, 240)"},onBack:n[0]||(n[0]=()=>a.$router.go(-1))},{extra:s(()=>[r(p,{onClick:$,key:"1",type:"primary"},{default:s(()=>[I(" Добавить клиента ")]),_:1})]),_:1}),r(ee,{onChange:n[2]||(n[2]=e=>H(e)),columns:Q,"data-source":B.value.data,pagination:{pageSize:10,total:B.value.total},"custom-row":e=>{if(e.id)return{onClick:l=>R(e.id)}}},{bodyCell:s(({column:e,record:l})=>[e.key==="action"?(i(),k(Z,{key:0,title:"Действительно удалить?","ok-text":"Да","cancel-text":"Нет",onConfirm:C=>K(C,l.id),onCancel:a.cancel},{default:s(()=>[r(re(ce),{onClick:n[1]||(n[1]=C=>J(C)),class:"w-10 h-10 cursor-pointer"})]),_:2},1032,["onConfirm","onCancel"])):F("",!0)]),_:1},8,["data-source","pagination","custom-row"]),r(M,{open:x.value,"onUpdate:open":n[4]||(n[4]=e=>x.value=e),footer:null,title:"ID: "+P.value,width:"80%",class:"h-[80vh]",onOk:z},{default:s(()=>[I(j(E.value)+" ",1),U("div",fe,[U("div",me,[r(N,{name:"basic"},{default:s(()=>[(i(!0),m(O,null,S(Object.entries(E.value),e=>(i(),m("div",{key:e},[r(w,{label:e[0],name:e[0]},{default:s(()=>[r(q,{value:e[1],"onUpdate:value":l=>e[1]=l,"default-value":e[1],onChange:A,class:"!w-full"},null,8,["value","onUpdate:value","default-value"])]),_:2},1032,["label","name"])]))),128))]),_:1}),r(p,{onClick:n[3]||(n[3]=e=>{console.log(D.value.map(l=>{const C=W.value[l.code];return{name:l.name,value:C,type:l.type,options:l.options}}))})},{default:s(()=>[I("test ")]),_:1})]),ve])]),_:1},8,["open","title"]),r(M,{open:_.value,"onUpdate:open":n[5]||(n[5]=e=>_.value=e),title:"Новый клиент",width:"30%",class:"h-[80vh]",onOk:G},{default:s(()=>[D.value?(i(),m("div",he,[r(N,{model:a.newItem,name:"basic",autocomplete:"off",onFinish:a.onFinish,onFinishFailed:a.onFinishFailed,layout:"vertical",class:"flex flex-col gap-6"},{default:s(()=>[(i(!0),m(O,null,S(D.value,e=>(i(),m("div",{key:e.code,class:"flex flex-col gap-4"},[U("div",null,[r(N,{model:a.newItem,name:"basic",autocomplete:"off",onFinish:a.onFinish,onFinishFailed:a.onFinishFailed,class:"flex flex-col gap-6"},{default:s(()=>[e.type==="text"||e.type==="email"||e.type==="textarea"?(i(),k(w,{key:0,label:e.name,name:e.name,rules:[{required:e.required}]},{default:s(()=>[r(q,{value:d.value[e.code],"onUpdate:value":l=>d.value[e.code]=l,ref_for:!0,ref:e.code,type:e.html,onChange:a.onChangeInput,class:"!w-full"},null,8,["value","onUpdate:value","type","onChange"])]),_:2},1032,["label","name","rules"])):F("",!0),e.type==="phone"?(i(),k(w,{key:1,label:e.name,name:e.name,rules:[{required:e.required}]},{default:s(()=>[ie(r(q,{value:d.value[e.code],"onUpdate:value":l=>d.value[e.code]=l,type:"tel",placeholder:"+7",class:"!w-[200px]"},null,8,["value","onUpdate:value"]),[[ne,"+# (###) ###-##-##"]])]),_:2},1032,["label","name","rules"])):F("",!0),e.type=="select"?(i(),k(w,{key:2,label:e.name,name:e.name,rules:[{required:e.required,message:"Required"}]},{default:s(()=>[r(ae,{value:d.value[e.code],"onUpdate:value":l=>d.value[e.code]=l,"show-search":"","filter-option":a.filterOption,class:"!w-full"},{default:s(()=>[(i(!0),m(O,null,S(e.options,l=>(i(),k(te,{key:l.id,value:l.id},{default:s(()=>[I(j(l.value),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","filter-option"])]),_:2},1032,["label","name","rules"])):F("",!0)]),_:2},1032,["model","onFinish","onFinishFailed"])])]))),128))]),_:1},8,["model","onFinish","onFinishFailed"])])):F("",!0)]),_:1},8,["open"])])}}};export{Ce as default};
