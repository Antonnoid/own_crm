import{u as B}from"./user.module-9c7fc94a.js";import{r as _,c as V,o as L,a as p,b as i,h as g,w as s,f as m,i as N,d as k,F as w,g as q,k as b,t as U,u as $,l as A,n as G,e as f,q as x}from"./index-602ec296.js";import{r as j}from"./TrashIcon-27ff1f98.js";import"./auth-header-ad4d04ca.js";const z={key:0},H={__name:"Modals",props:{routeName:String,open:Boolean},emits:["toggle"],setup(M,{emit:R}){const l=M,a=B(),v=_(!1),h=V(()=>c.value&&c.value[0]?"Добавить новый "+c.value[0].title:"Добавить новый"),d=_({place:l.routeName,fields:{}}),I=()=>{R("toggle")},c=_([]),E=_([]),D=async()=>{try{await a.getPlacesSubChild(l.routeName),c.value=a.placesSubChild}catch(n){console.error("Error fetching data in component:",n)}},O=async n=>{await a.getOptionsData(n),E.value=a.optionData},P=async n=>{v.value=!0,await a.addNewPlaceChild(d.value),await a.getPlacesChild(l.routeName),v.value=!1,R("toggle"),Object.keys(d.value).forEach(y=>{d.value[y]=""})};L(()=>{D(),F()});const F=async()=>{try{await a.getPlacesChild("regions"),await a.getPlacesChild("districts"),await a.getPlacesChild("vicinity"),await a.getPlacesChild("metro_line")}catch(n){console.error("Error fetching data in component:",n)}};return(n,y)=>{const S=p("a-input"),t=p("a-form-item"),r=p("a-select-option"),C=p("a-select"),Y=p("a-form"),u=p("a-button"),T=p("a-modal");return i(),g(T,{open:l.open,"onUpdate:open":y[0]||(y[0]=e=>l.open=e),title:h.value,onOk:P,closable:"",onCancel:I},{footer:s(()=>[m(u,{key:"back",onClick:I},{default:s(()=>[N("Отменить")]),_:1}),m(u,{key:"submit",type:"primary",loading:v.value,onClick:P},{default:s(()=>[N("Сохранить")]),_:1},8,["loading"])]),default:s(()=>[m(Y,{name:"basic",autocomplete:"off",onFinish:n.onFinish,onFinishFailed:n.onFinishFailed},{default:s(()=>[c.value&&c.value[0]?(i(),k("div",z,[(i(!0),k(w,null,q(c.value[0].fields,e=>(i(),k("div",{key:e.id},[e.type==="text"?(i(),g(t,{key:0,label:e.name,name:e.name,rules:[{required:e.required}]},{default:s(()=>[m(S,{value:d.value.fields[e.code],"onUpdate:value":o=>d.value.fields[e.code]=o,ref_for:!0,ref:e.code,type:e.html,onChange:n.onChangeInput,class:"!w-[200px]"},null,8,["value","onUpdate:value","type","onChange"])]),_:2},1032,["label","name","rules"])):b("",!0),e.type=="select"&&e.mode=="static"?(i(),g(t,{key:1,label:e.name,name:e.name,rules:[{required:e.required,message:"Required"}]},{default:s(()=>[m(C,{value:d.value.fields[e.code],"onUpdate:value":o=>d.value.fields[e.code]=o,"show-search":"","filter-option":n.filterOption,class:"!w-[200px]"},{default:s(()=>[(i(!0),k(w,null,q(e.options,o=>(i(),g(r,{key:o.id,value:o.id},{default:s(()=>[N(U(o.value),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","filter-option"])]),_:2},1032,["label","name","rules"])):b("",!0),e.type=="select"&&e.mode=="ajax"?(i(),g(t,{key:2,label:e.name,name:e.name,rules:[{required:e.required,message:"Required"}]},{default:s(()=>[m(C,{value:e.code,"onUpdate:value":o=>e.code=o,"show-search":"","filter-option":n.filterOption,onFocus:o=>O(e.code),class:"!w-[200px]"},{default:s(()=>[(i(!0),k(w,null,q(E.value,o=>(i(),g(r,{key:o.id,value:o.value},{default:s(()=>[N(U(o.value),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","filter-option","onFocus"])]),_:2},1032,["label","name","rules"])):b("",!0)]))),128))])):b("",!0)]),_:1},8,["onFinish","onFinishFailed"])]),_:1},8,["open","title"])}}},J={id:"app"},K={class:"filter"},Q={class:"filter__task --w-refresh hidden-desktop"},W=f("div",{class:"filter__task-t"},[f("p",{class:"filter__text"},"Фильтр")],-1),X={class:"filter__refresh"},le={__name:"_id",setup(M){const R=_([]),l=B(),a=$(),v=_(!1),h=_(!1),d=_(),I=A({type:"new",data:{NAME:"",PROPERTY_REGION_TYPE:"",PROPERTY_REGION_ID:"",PROPERTY_FOR_TITLE:"",PROPERTY_LOCALITY_TYPE:"",PROPERTY_DISTRICT_ID:"",PROPERTY_VICINITY_ID:""},place:a.params.id}),c=()=>{v.value=!v.value},E=[{title:"id",key:"id",dataIndex:"id",width:50},{title:"Название",dataIndex:"value",key:"value"},{title:"Действия",key:"action",width:50}],D=G(),O=t=>{D.push("/places/"+a.params.id+"/"+t)},P=V(()=>a.params.id==="regions"?l.regions:a.params.id==="vicinity"?l.vicinities:a.params.id==="highway"?l.highways:a.params.id==="localities"?l.localities:a.params.id==="highways"?l.highways:a.params.id==="place"?l.place:a.params.id==="districts"?l.districts:a.params.id==="metro"?l.metro:a.params.id==="metro_line"?l.metro_line:[]),F=async t=>{},n=async(t,r)=>{r.preventDefault(),d.value=t.id,h.value=!0;const C={type:"delete",id:t.id,place:a.params.id,data:{NAME:t.value,PROPERTY_REGION_TYPE:""}};await l.addNewPlaceChild(C),await l.getPlacesChild(a.params.id),R.value=l.placesChild,h.value=!1},y=t=>{t.preventDefault(),t.stopPropagation()};L(()=>{S()});const S=async()=>{h.value=!0;try{await l.getPlacesChild(a.params.id).then(t=>{t.data.result==="error"&&message.error(t.data.text),h.value=!1})}catch(t){console.error("Error fetching data in component:",t)}};return(t,r)=>{const C=p("a-popconfirm"),Y=p("a-table");return i(),k("div",null,[f("main",J,[f("div",K,[f("div",Q,[W,f("div",X,[f("div",{onClick:r[0]||(r[0]=u=>t.clearFilter()),class:"filter__refresh-btn"}," Сбросить "),f("div",{onClick:c,class:"filter__refresh-btn"}," Добавить "+U(x(a).params.id),1),m(H,{routeName:x(a).params.id,open:v.value,newItem:I,onToggle:c,onSave:F},null,8,["routeName","open","newItem"])])])]),m(Y,{onChange:r[2]||(r[2]=u=>t.onTableChange(u)),columns:E,"data-source":P.value,pagination:{pageSize:10,total:P.value.total},"custom-row":u=>{if(u.id)return{onClick:T=>O(u.id)}}},{bodyCell:s(({column:u,record:T})=>[u.key==="action"?(i(),g(C,{key:0,title:"Действительно удалить?","ok-text":"Да","cancel-text":"Нет",onConfirm:e=>n(T,e),onCancel:t.cancel},{default:s(()=>[m(x(j),{onClick:r[1]||(r[1]=e=>y(e)),class:"w-10 h-10 cursor-pointer"})]),_:2},1032,["onConfirm","onCancel"])):b("",!0)]),_:1},8,["data-source","pagination","custom-row"])])])}}};export{le as default};
