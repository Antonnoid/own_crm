import{s as g,v as ne,m as k,r as h,o as se,c as j,a as c,x as oe,b as r,d as v,f as i,w as s,i as I,h as p,n as re,k as f,e as O,F as E,g as N,y as $,t as z}from"./index-dc8ff5dc.js";import{a as _}from"./auth-header-ad4d04ca.js";import{r as ie}from"./TrashIcon-3bffa9f5.js";const C="https://crm.web-hands.ru/api/v1";class ue{getMe(){return g.get(C+"/user/",{headers:_()})}getClients(){return g.get(C+"/clients/list/",{headers:_()})}getClientData(t){return g.get(C+"/clients/data/?id="+t,{headers:_()})}createNewClient(t){return g.post(C+"/clients/save/",t,{headers:_()})}deleteClient(t){return g.post(C+"/clients/delete/",t,{headers:_()})}getClientFields(){return g.get(C+"/clients/fields/",{headers:_()})}}const x=new ue,ce=ne("client",{state:()=>({clients:[],client:{},clientFields:[]}),actions:{async getClientsList(){try{const o=await x.getClients();return this.clients=o.data,o}catch(o){return Promise.reject(o)}},async getClientData(o){try{const t=await x.getClientData(o);return this.client=t.data.data,t}catch(t){return Promise.reject(t)}},async createNewClient(o){try{const t=await x.createNewClient(o);console.log("resssspo",t),t.data.code===200?k.success(t.data.data):(console.error("Error fetching data:",t.statusText),k.error(t.data.data))}catch(t){console.error("Error fetching data:",t)}},async deleteClient(o){try{const t=await x.deleteClient(o);t.data.code===200?k.success(t.data.data):(console.error("Error fetching data:",t.statusText),k.error(t.data.data))}catch(t){console.error("Error fetching data:",t)}},async getClientFields(){try{const o=await x.getClientFields();return this.clientFields=o.data.data,o}catch(o){return Promise.reject(o)}}}}),de={class:"w-full p-8",style:{height:"calc(100vh - 92px)"}},pe={class:"flex w-full mt-20"},me={class:"w-1/2"},ve=O("div",{class:"w-1/2 bg-stone-200"},"ddd",-1),fe={key:0},_e={__name:"index",setup(o){const t=ce(),u=h(!1),D=h(!1),P=h(null),F=h(!1),U=h(null),A=async()=>{try{await t.getClientFields(),U.value=t.clientFields,console.log("res",data.value)}catch(a){console.error("Error fetching data in component:",a)}},d=h({type:1}),H=async a=>{D.value=!0,P.value=a,ee(a)},G=()=>{F.value=!F.value},J=h({}),K=a=>{console.log(a),D.value=!1},Q=a=>{console.log("p",a)},W=async a=>{const n=new FormData;for(var m in d.value)d.value.hasOwnProperty(m)&&n.append(m,d.value[m]);u.value=!0,await t.createNewClient(n),await t.getClientsList(),u.value=!1,F.value=!1},X=a=>{a.preventDefault(),a.stopPropagation()},Y=async(a,n)=>{u.value=!0;const m={id:n};await t.deleteClient(m),u.value=!0,L()},Z=[{title:"id",key:"id",dataIndex:"id",width:50},{title:"Клиент",dataIndex:"fio",key:"fio"},{title:"Телефон",dataIndex:"phone_format",key:"phone"},{title:"Email",dataIndex:"email",key:"email"},{title:"O клиенте",dataIndex:"about",key:"about"},{title:"Действие",key:"action"}];se(()=>{L(),A()});const B=j(()=>t.clients),w=j(()=>t.client),L=async()=>{u.value=!0;try{await t.getClientsList().then(a=>{a.data.result==="error"&&k.error(a.data.text),u.value=!1})}catch(a){console.error("Error fetching data in component:",a)}},ee=async a=>{u.value=!0;try{await t.getClientData(a).then(n=>{n.data.result==="error"&&k.error(n.data.text),u.value=!1})}catch(n){console.error("Error fetching data in component:",n)}};return(a,n)=>{const m=c("a-button"),te=c("a-page-header"),ae=c("a-popconfirm"),le=c("a-table"),q=c("a-input"),y=c("a-form-item"),M=c("a-select-option"),V=c("a-select"),S=c("a-form"),R=c("a-modal"),T=oe("mask");return r(),v("div",de,[i(te,{class:"demo-page-header",style:{border:"1px solid rgb(235, 237, 240)"},onBack:n[0]||(n[0]=()=>a.$router.go(-1))},{extra:s(()=>[i(m,{onClick:G,key:"1",type:"primary"},{default:s(()=>[I(" Добавить клиента ")]),_:1})]),_:1}),i(le,{onChange:n[2]||(n[2]=e=>Q(e)),columns:Z,"data-source":B.value.data,pagination:{pageSize:10,total:B.value.total},"custom-row":e=>{if(e.id)return{onClick:l=>H(e.id)}}},{bodyCell:s(({column:e,record:l})=>[e.key==="action"?(r(),p(ae,{key:0,title:"Действительно удалить?","ok-text":"Да","cancel-text":"Нет",onConfirm:b=>Y(b,l.id),onCancel:a.cancel},{default:s(()=>[i(re(ie),{onClick:n[1]||(n[1]=b=>X(b)),class:"w-10 h-10 cursor-pointer"})]),_:2},1032,["onConfirm","onCancel"])):f("",!0)]),_:1},8,["data-source","pagination","custom-row"]),i(R,{open:D.value,"onUpdate:open":n[4]||(n[4]=e=>D.value=e),footer:null,title:"ID: "+P.value,width:"80%",class:"h-[80vh]",onOk:K},{default:s(()=>[O("div",pe,[O("div",me,[(r(!0),v(E,null,N(J.value,e=>(r(),v("div",{key:e.name},[i(S,{name:"basic"},{default:s(()=>[e.type==="text"||e.type==="email"||e.type==="textarea"?(r(),p(y,{key:0,label:e.name,name:e.name,rules:[{required:e.required}]},{default:s(()=>[i(q,{value:e.value,"onUpdate:value":l=>e.value=l,ref_for:!0,ref:e.code,type:e.html,onChange:a.onChangeInput,class:"!w-full"},null,8,["value","onUpdate:value","type","onChange"])]),_:2},1032,["label","name","rules"])):f("",!0),e.type==="phone"?(r(),p(y,{key:1,label:e.name,name:e.name,rules:[{required:e.required}]},{default:s(()=>[$(i(q,{value:e.value,"onUpdate:value":l=>e.value=l,type:"tel",placeholder:"+7"},null,8,["value","onUpdate:value"]),[[T,"+# (###) ###-##-##"]])]),_:2},1032,["label","name","rules"])):f("",!0),e.type=="select"?(r(),p(y,{key:2,label:e.name,name:e.name,rules:[{required:e.required,message:"Required"}]},{default:s(()=>[i(V,{value:e.value,"onUpdate:value":l=>e.value=l,"show-search":"","filter-option":a.filterOption,class:"!w-full"},{default:s(()=>[(r(!0),v(E,null,N(e.options,l=>(r(),p(M,{key:l.id,value:l.id},{default:s(()=>[I(z(l.value),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","filter-option"])]),_:2},1032,["label","name","rules"])):f("",!0)]),_:2},1024)]))),128)),i(m,{onClick:n[3]||(n[3]=e=>{console.log(U.value.map(l=>{const b=w.value[l.code];return{name:l.name,value:b,type:l.type,options:l.options}}))})},{default:s(()=>[I("test ")]),_:1})]),ve])]),_:1},8,["open","title"]),i(R,{open:F.value,"onUpdate:open":n[5]||(n[5]=e=>F.value=e),title:"Новый клиент",width:"30%",class:"h-[80vh]",onOk:W},{default:s(()=>[U.value?(r(),v("div",fe,[i(S,{model:a.newItem,name:"basic",autocomplete:"off",onFinish:a.onFinish,onFinishFailed:a.onFinishFailed,layout:"vertical",class:"flex flex-col gap-6"},{default:s(()=>[(r(!0),v(E,null,N(U.value,e=>(r(),v("div",{key:e.code,class:"flex flex-col gap-4"},[O("div",null,[i(S,{model:a.newItem,name:"basic",autocomplete:"off",onFinish:a.onFinish,onFinishFailed:a.onFinishFailed,class:"flex flex-col gap-6"},{default:s(()=>[e.type==="text"||e.type==="email"||e.type==="textarea"?(r(),p(y,{key:0,label:e.name,name:e.name,rules:[{required:e.required}]},{default:s(()=>[i(q,{value:d.value[e.code],"onUpdate:value":l=>d.value[e.code]=l,ref_for:!0,ref:e.code,type:e.html,onChange:a.onChangeInput,class:"!w-full"},null,8,["value","onUpdate:value","type","onChange"])]),_:2},1032,["label","name","rules"])):f("",!0),e.type==="phone"?(r(),p(y,{key:1,label:e.name,name:e.name,rules:[{required:e.required}]},{default:s(()=>[$(i(q,{value:d.value[e.code],"onUpdate:value":l=>d.value[e.code]=l,type:"tel",placeholder:"+7",class:"!w-[200px]"},null,8,["value","onUpdate:value"]),[[T,"+# (###) ###-##-##"]])]),_:2},1032,["label","name","rules"])):f("",!0),e.type=="select"?(r(),p(y,{key:2,label:e.name,name:e.name,rules:[{required:e.required,message:"Required"}]},{default:s(()=>[i(V,{value:d.value[e.code],"onUpdate:value":l=>d.value[e.code]=l,"show-search":"","filter-option":a.filterOption,class:"!w-full"},{default:s(()=>[(r(!0),v(E,null,N(e.options,l=>(r(),p(M,{key:l.id,value:l.id},{default:s(()=>[I(z(l.value),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","filter-option"])]),_:2},1032,["label","name","rules"])):f("",!0)]),_:2},1032,["model","onFinish","onFinishFailed"])])]))),128))]),_:1},8,["model","onFinish","onFinishFailed"])])):f("",!0)]),_:1},8,["open"])])}}};export{_e as default};
